<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>转图功能测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-result {
            background: #f5f5f5;
            padding: 10px;
            margin: 10px 0;
            border-radius: 3px;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        .code {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 3px;
            font-family: monospace;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>转图功能手动测试</h1>
    
    <div class="test-section">
        <h2>测试说明</h2>
        <p>这个页面用于手动测试转图功能的各个组件。请按照以下步骤进行测试：</p>
        <ol>
            <li>确保开发服务器正在运行：<code>npm run dev</code></li>
            <li>在新标签页中打开：<a href="http://localhost:5175/md/" target="_blank">http://localhost:5175/md/</a></li>
            <li>按照下面的测试步骤进行验证</li>
        </ol>
    </div>

    <div class="test-section">
        <h2>步骤 1: 检查界面元素</h2>
        <div class="test-result">
            <strong>检查项目：</strong>
            <ul>
                <li>页面是否正常加载</li>
                <li>是否有『转图』按钮（在复制按钮左侧）</li>
                <li>右侧设置面板是否有 GitHub 图床配置</li>
            </ul>
        </div>
        <button onclick="window.open('http://localhost:5175/md/', '_blank')">打开应用</button>
    </div>

    <div class="test-section">
        <h2>步骤 2: 配置 GitHub 图床</h2>
        <div class="test-result">
            <strong>配置信息：</strong>
            <div class="code">Repository: zillionare/marktwain
Access Token: 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
Branch: main</div>
        </div>
        <p>在应用中点击右侧设置按钮，找到 GitHub 图床配置，填入上述信息，然后点击『测试图床』。</p>
    </div>

    <div class="test-section">
        <h2>步骤 3: 输入测试内容</h2>
        <div class="test-result">
            <strong>测试内容：</strong>
            <div class="code"># 转图功能测试

## Admonition 测试

!!! note "重要提示"
    这是一个测试 admonition 块。

## 代码块测试

```javascript
console.log("Hello World");
```

## 数学公式测试

$$
E = mc^2
$$</div>
        </div>
        <button onclick="copyTestContent()">复制测试内容</button>
    </div>

    <div class="test-section">
        <h2>步骤 4: 验证渲染</h2>
        <div class="test-result">
            <strong>验证项目：</strong>
            <ul>
                <li>Admonition 块是否正确渲染</li>
                <li>代码块是否有语法高亮</li>
                <li>数学公式是否正确显示</li>
                <li>每个块是否有唯一 ID 和 data-block-type 属性</li>
            </ul>
        </div>
        <button onclick="generateValidationScript()">生成验证脚本</button>
        <div id="validation-script" class="code" style="display: none;"></div>
    </div>

    <div class="test-section">
        <h2>步骤 5: 测试转图功能</h2>
        <div class="test-result">
            <strong>测试步骤：</strong>
            <ol>
                <li>点击『转图』按钮</li>
                <li>观察是否有成功提示</li>
                <li>切换复制模式为『MD 格式』</li>
                <li>点击复制按钮</li>
                <li>检查剪贴板内容是否包含图片链接</li>
            </ol>
        </div>
    </div>

    <div class="test-section">
        <h2>步骤 6: 验证防重复功能</h2>
        <div class="test-result">
            <strong>测试步骤：</strong>
            <ol>
                <li>再次点击『转图』按钮</li>
                <li>应该显示『内容未改变，不需要重复执行』</li>
                <li>修改任意一个块的内容</li>
                <li>再次点击『转图』按钮</li>
                <li>只有修改的块应该被重新转换</li>
            </ol>
        </div>
    </div>

    <div class="test-section">
        <h2>测试结果记录</h2>
        <div id="test-results">
            <div class="test-result">
                <label><input type="checkbox"> 界面元素正常显示</label>
            </div>
            <div class="test-result">
                <label><input type="checkbox"> GitHub 图床配置成功</label>
            </div>
            <div class="test-result">
                <label><input type="checkbox"> 测试内容正确渲染</label>
            </div>
            <div class="test-result">
                <label><input type="checkbox"> 块元素有正确的 ID 和属性</label>
            </div>
            <div class="test-result">
                <label><input type="checkbox"> 转图功能正常工作</label>
            </div>
            <div class="test-result">
                <label><input type="checkbox"> MD 格式复制包含图片链接</label>
            </div>
            <div class="test-result">
                <label><input type="checkbox"> 防重复功能正常</label>
            </div>
        </div>
        <button onclick="generateTestReport()">生成测试报告</button>
        <div id="test-report"></div>
    </div>

    <script>
        function copyTestContent() {
            const content = `# 转图功能测试

## Admonition 测试

!!! note "重要提示"
    这是一个测试 admonition 块。

## 代码块测试

\`\`\`javascript
console.log("Hello World");
\`\`\`

## 数学公式测试

$$
E = mc^2
$$`;
            
            navigator.clipboard.writeText(content).then(() => {
                alert('测试内容已复制到剪贴板！');
            }).catch(err => {
                console.error('复制失败:', err);
                alert('复制失败，请手动复制内容');
            });
        }

        function generateValidationScript() {
            const script = `// 在浏览器开发者工具中运行此脚本
console.log('=== 转图功能验证脚本 ===');

// 检查转图按钮
const convertButton = Array.from(document.querySelectorAll('button')).find(btn => 
  btn.textContent.includes('转图')
);
console.log('转图按钮:', convertButton ? '✅ 存在' : '❌ 不存在');

// 检查特殊块
const admonitionBlocks = document.querySelectorAll('[data-block-type="admonition"]');
const fencedBlocks = document.querySelectorAll('[data-block-type="fenced"]');
const mathBlocks = document.querySelectorAll('[data-block-type="math"]');

console.log('Admonition 块数量:', admonitionBlocks.length);
console.log('代码块数量:', fencedBlocks.length);
console.log('数学公式块数量:', mathBlocks.length);

// 检查 ID
admonitionBlocks.forEach((block, index) => {
  console.log(\`Admonition \${index + 1} ID:\`, block.id);
});
fencedBlocks.forEach((block, index) => {
  console.log(\`Fenced \${index + 1} ID:\`, block.id);
});
mathBlocks.forEach((block, index) => {
  console.log(\`Math \${index + 1} ID:\`, block.id);
});

console.log('=== 验证完成 ===');`;

            const scriptDiv = document.getElementById('validation-script');
            scriptDiv.textContent = script;
            scriptDiv.style.display = 'block';
            
            navigator.clipboard.writeText(script).then(() => {
                alert('验证脚本已复制到剪贴板！请在浏览器开发者工具中运行。');
            }).catch(err => {
                console.error('复制失败:', err);
            });
        }

        function generateTestReport() {
            const checkboxes = document.querySelectorAll('#test-results input[type="checkbox"]');
            const results = Array.from(checkboxes).map(cb => ({
                test: cb.parentElement.textContent.trim(),
                passed: cb.checked
            }));
            
            const passedCount = results.filter(r => r.passed).length;
            const totalCount = results.length;
            
            const report = `
测试报告 - ${new Date().toLocaleString()}
===========================================

总体结果: ${passedCount}/${totalCount} 项测试通过

详细结果:
${results.map(r => `${r.passed ? '✅' : '❌'} ${r.test}`).join('\n')}

${passedCount === totalCount ? '🎉 所有测试通过！' : '⚠️ 部分测试失败，请检查相关功能。'}
`;
            
            const reportDiv = document.getElementById('test-report');
            reportDiv.innerHTML = `<div class="test-result ${passedCount === totalCount ? 'success' : 'warning'}"><pre>${report}</pre></div>`;
        }
    </script>
</body>
</html>
